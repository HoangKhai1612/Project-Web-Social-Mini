<!doctype html>
<html lang="vi" class="h-full bg-slate-50">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialVN | K·∫øt n·ªëi c·ªông ƒë·ªìng</title>

    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: 'var(--primary-blue)',
                        secondary: 'var(--text-muted)',
                        surface: 'var(--surface-color)',
                        base: 'var(--border-color)',
                        content: 'var(--text-main)',
                    },
                    zIndex: {
                        '100': '100',
                        '1000': '1000',
                        '2000': '2000',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Toast & Modal UI */
        #toastContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        /* Animation cho b√†i vi·∫øt v√† modal */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body
    class="h-full overflow-hidden text-slate-800 dark:text-slate-100 bg-slate-50 dark:bg-slate-950 transition-colors duration-300">

    <div id="app" class="h-full w-full flex flex-col">
        <div class="flex items-center justify-center h-full">
            <div class="animate-pulse flex flex-col items-center">
                <div
                    class="w-16 h-16 bg-blue-600 rounded-2xl mb-4 shadow-lg shadow-blue-200 flex items-center justify-center text-white text-3xl">
                    üåê</div>
                <p class="text-slate-400 font-medium">ƒêang kh·ªüi t·∫°o SocialVN...</p>
            </div>
        </div>
    </div>

    <div id="modalSystem" class="hidden fixed inset-0 z-[2000] flex items-center justify-center p-4">
        <div class="modal-overlay absolute inset-0" onclick="window.closeModal()"></div>

        <div
            class="relative bg-white dark:bg-slate-800 w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden transform transition-all scale-100 flex flex-col max-h-[90vh] border border-slate-100 dark:border-slate-700">
            <div
                class="px-6 py-4 border-b dark:border-slate-700 flex justify-between items-center bg-white dark:bg-slate-800 sticky top-0 z-10">
                <h3 id="modalTitle" class="text-lg font-bold text-slate-800 dark:text-white">Ti√™u ƒë·ªÅ</h3>
                <button onclick="window.closeModal()"
                    class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full text-slate-400 hover:text-red-500 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div id="modalBody" class="p-6 overflow-y-auto custom-scrollbar">
            </div>
        </div>
    </div>

    <div id="toastContainer" class="flex flex-col gap-2"></div>

    <template id="tpl-toast">
        <div
            class="toast-item flex items-center p-4 rounded-2xl shadow-2xl border dark:border-slate-700 bg-white dark:bg-slate-800 min-w-[300px] animate-fade-in-right">
            <div class="toast-icon w-10 h-10 rounded-full flex items-center justify-center mr-3 shrink-0"></div>
            <div class="flex-1">
                <p class="toast-msg text-sm font-semibold text-slate-700 dark:text-slate-200"></p>
            </div>
        </div>
    </template>

    <!-- REPORT MODAL TEMPLATE -->
    <template id="tpl-report-modal">
        <div class="p-6">
            <h3 class="text-xl font-bold bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent mb-4">
                üì¢ B√°o c√°o vi ph·∫°m</h3>
            <form id="reportForm" onsubmit="window.handleReportSubmit(event)">
                <input type="hidden" id="reportTargetType">
                <input type="hidden" id="reportTargetId">

                <div class="space-y-3 mb-4 max-h-64 overflow-y-auto pr-2 custom-scrollbar">
                    <p class="font-medium text-slate-700 dark:text-slate-300">Vui l√≤ng ch·ªçn l√Ω do vi ph·∫°m:</p>

                    <label
                        class="flex items-start p-3 border dark:border-slate-600 rounded-lg cursor-pointer hover:bg-red-50 dark:hover:bg-slate-700 transition group">
                        <input type="radio" name="reason" value="spam"
                            class="mt-1 w-4 h-4 text-red-600 focus:ring-red-500" checked>
                        <div class="ml-3">
                            <div
                                class="font-bold text-sm text-slate-800 dark:text-slate-200 group-hover:text-red-700 dark:group-hover:text-red-400">
                                üö´ N·ªôi dung r√°c (Spam)</div>
                            <div class="text-xs text-slate-500 dark:text-slate-400">ƒêƒÉng t·∫£i qu√° nhi·ªÅu n·ªôi dung l·∫∑p l·∫°i,
                                qu·∫£ng c√°o tr√°i ph√©p</div>
                        </div>
                    </label>

                    <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-red-50 transition">
                        <input type="radio" name="reason" value="hate_speech" class="mt-1 w-4 h-4 text-red-600">
                        <div class="ml-3">
                            <div class="font-bold text-sm text-slate-800">üò° Ng√¥n t·ª´ g√¢y th√π gh√©t</div>
                            <div class="text-xs text-slate-500">Ph√¢n bi·ªát ƒë·ªëi x·ª≠ v·ªÅ ch·ªßng t·ªôc, t√¥n gi√°o, gi·ªõi t√≠nh</div>
                        </div>
                    </label>

                    <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-red-50 transition">
                        <input type="radio" name="reason" value="harassment" class="mt-1 w-4 h-4 text-red-600">
                        <div class="ml-3">
                            <div class="font-bold text-sm text-slate-800">‚ö†Ô∏è Qu·∫•y r·ªëi v√† b·∫Øt n·∫°t</div>
                            <div class="text-xs text-slate-500">ƒêe d·ªça, l√†m phi·ªÅn ng∆∞·ªùi d√πng kh√°c</div>
                        </div>
                    </label>

                    <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-red-50 transition">
                        <input type="radio" name="reason" value="sensitive_content" class="mt-1 w-4 h-4 text-red-600">
                        <div class="ml-3">
                            <div class="font-bold text-sm text-slate-800">üîû N·ªôi dung nh·∫°y c·∫£m/B·∫°o l·ª±c</div>
                            <div class="text-xs text-slate-500">H√¨nh ·∫£nh khi√™u d√¢m, b·∫°o l·ª±c m√°u me</div>
                        </div>
                    </label>

                    <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-red-50 transition">
                        <input type="radio" name="reason" value="impersonation" class="mt-1 w-4 h-4 text-red-600">
                        <div class="ml-3">
                            <div class="font-bold text-sm text-slate-800">üë§ M·∫°o danh</div>
                            <div class="text-xs text-slate-500">Gi·∫£ m·∫°o t√†i kho·∫£n ng∆∞·ªùi kh√°c</div>
                        </div>
                    </label>

                    <label class="flex items-start p-3 border rounded-lg cursor-pointer hover:bg-red-50 transition">
                        <input type="radio" name="reason" value="privacy_violation" class="mt-1 w-4 h-4 text-red-600">
                        <div class="ml-3">
                            <div class="font-bold text-sm text-slate-800">üîí Vi ph·∫°m quy·ªÅn ri√™ng t∆∞</div>
                            <div class="text-xs text-slate-500">Chia s·∫ª th√¥ng tin c√° nh√¢n khi ch∆∞a ƒë∆∞·ª£c ph√©p (Doxxing)
                            </div>
                        </div>
                    </label>
                </div>

                <div class="mb-4">
                    <label for="reportDescription" class="block mb-2 text-sm font-medium text-slate-700">M√¥ t·∫£ chi ti·∫øt
                        (T√πy ch·ªçn):</label>
                    <textarea id="reportDescription" rows="3"
                        class="w-full p-2.5 bg-slate-50 border border-slate-300 rounded-lg text-sm focus:ring-red-500 focus:border-red-500"
                        placeholder="H√£y m√¥ t·∫£ th√™m v·ªÅ v·∫•n ƒë·ªÅ b·∫°n g·∫∑p ph·∫£i..."></textarea>
                </div>

                <div class="flex justify-end gap-2">
                    <button type="button" onclick="window.closeModal()"
                        class="px-4 py-2 text-sm font-medium text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200">H·ªßy</button>
                    <button type="submit"
                        class="px-4 py-2 text-sm font-bold text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md transition transform active:scale-95">G·ª≠i
                        b√°o c√°o</button>
                </div>
            </form>
        </div>
    </template>

    <script type="module" src="js/main.js?v=2"></script>

    <script>
        /**
         * M·ªü Modal h·ªá th·ªëng
         */
        window.openModal = function (title, htmlContent) {
            const modal = document.getElementById('modalSystem');
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalBody').innerHTML = htmlContent;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        /**
         * ƒê√≥ng Modal h·ªá th·ªëng
         */
        window.closeModal = function () {
            const modal = document.getElementById('modalSystem');
            modal.classList.add('hidden');
            document.getElementById('modalBody').innerHTML = '';
            document.body.style.overflow = '';
        };

        /**
         * Hi·ªÉn th·ªã th√¥ng b√°o Toast chuy√™n nghi·ªáp
         * @param {string} msg - N·ªôi dung
         * @param {string} type - 'success', 'error', 'info'
         */
        window.showToast = function (msg, type = 'info') {
            const container = document.getElementById('toastContainer');
            const template = document.getElementById('tpl-toast');
            const clone = template.content.cloneNode(true);

            const item = clone.querySelector('.toast-item');
            const iconBox = clone.querySelector('.toast-icon');
            const msgBox = clone.querySelector('.toast-msg');

            msgBox.innerText = msg;

            // C·∫•u h√¨nh m√†u s·∫Øc theo lo·∫°i
            if (type === 'success') {
                iconBox.innerHTML = '‚úÖ';
                iconBox.classList.add('bg-green-100');
                item.classList.add('border-green-200');
            } else if (type === 'error') {
                iconBox.innerHTML = '‚ùå';
                iconBox.classList.add('bg-red-100');
                item.classList.add('border-red-200');
            } else {
                iconBox.innerHTML = '‚ÑπÔ∏è';
                iconBox.classList.add('bg-blue-100');
                item.classList.add('border-blue-200');
            }

            container.appendChild(item);

            // T·ª± ƒë·ªông x√≥a sau 3.5 gi√¢y
            setTimeout(() => {
                item.style.opacity = '0';
                item.style.transform = 'translateX(100px)';
                item.style.transition = 'all 0.5s ease';
                setTimeout(() => item.remove(), 500);
            }, 3500);
        };

        // L·∫Øng nghe ph√≠m ESC ƒë·ªÉ ƒë√≥ng modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') window.closeModal();
        });

        // X·ª≠ l√Ω l·ªói ·∫£nh m·∫∑c ƒë·ªãnh to√†n c·ª•c
        document.addEventListener('error', function (e) {
            if (e.target.tagName.toLowerCase() === 'img') {
                // N·∫øu l√† avatar l·ªói -> d√πng ·∫£nh default
                if (e.target.id === 'userAvatar' || e.target.classList.contains('avatar')) {
                    e.target.src = 'images/default.png';
                }
                // N·∫øu l√† ·∫£nh b√¨a l·ªói
                if (e.target.id === 'coverImg') {
                    e.target.src = 'images/default_cover.png';
                }
            }
        }, true);
    </script>
</body>

</html>